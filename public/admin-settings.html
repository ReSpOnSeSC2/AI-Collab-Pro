<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System Settings - Admin Dashboard</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="/css/admin-shared.css">
    <script>
        // Apply theme before DOM content loads to prevent flash
        (function() {
            var savedThemeValue = localStorage.getItem('theme') || 'theme-dark';
            document.documentElement.className = savedThemeValue;
        })();
    </script>
    <style>
        @media (max-width: 768px) {
            #settingsTabList {
                flex-direction: column;
            }
            #settingsTabList .nav-link {
                width: 100%;
                text-align: left;
                border-radius: 0.25rem !important;
                margin-bottom: 0.25rem;
            }
        }
        .setting-group {
            border: 1px solid var(--nexus-border);
            border-radius: var(--nexus-radius);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            background-color: rgba(255, 255, 255, 0.02);
        }
        .theme-light .setting-group {
            background-color: #f8f9fa;
        }
        .setting-title {
            margin-bottom: 0.5rem;
            font-weight: 600;
        }
        .setting-description {
            color: var(--nexus-text-secondary);
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }
        .form-text {
            color: var(--nexus-text-secondary);
            font-size: 0.8rem;
        }
        .token-display {
            font-family: var(--nexus-mono);
            background-color: rgba(0, 0, 0, 0.3);
            padding: 0.75rem 1rem;
            border-radius: var(--nexus-radius-sm);
            word-break: break-all;
            user-select: all;
        }
        .theme-light .token-display {
            background-color: #e9ecef;
            color: #212529;
        }
        
        /* API method badges */
        .api-method {
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: 600;
        }
        .api-method.get {
            background-color: rgba(52, 152, 219, 0.2);
            color: #3498db;
        }
        .api-method.post {
            background-color: rgba(46, 204, 113, 0.2);
            color: #2ecc71;
        }
        .api-method.put {
            background-color: rgba(241, 196, 15, 0.2);
            color: #f1c40f;
        }
        .api-method.delete {
            background-color: rgba(231, 76, 60, 0.2);
            color: #e74c3c;
        }
        
        /* Log table styles */
        .log-table {
            font-size: 0.85rem;
        }
        .log-table tbody {
            max-height: 400px;
            overflow-y: auto;
        }
        .log-level {
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: 600;
        }
        .log-info {
            background-color: rgba(52, 152, 219, 0.2);
            color: #3498db;
        }
        .log-warn {
            background-color: rgba(241, 196, 15, 0.2);
            color: #f1c40f;
        }
        .log-error {
            background-color: rgba(231, 76, 60, 0.2);
            color: #e74c3c;
        }
        .log-debug {
            background-color: rgba(149, 165, 166, 0.2);
            color: #95a5a6;
        }
        
        /* Code editor for JSON */
        .json-editor {
            font-family: var(--nexus-mono);
            line-height: 1.5;
            tab-size: 2;
            font-size: 0.9rem;
            resize: vertical;
            min-height: 200px;
            background-color: rgba(0, 0, 0, 0.2);
            color: var(--nexus-text);
            border: 1px solid var(--nexus-border);
            border-radius: var(--nexus-radius-sm);
        }
        .theme-light .json-editor {
            background-color: #f8f9fa;
            color: #212529;
        }
        
        /* System info card */
        .system-info-item {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--nexus-border);
        }
        .system-info-item:last-child {
            border-bottom: none;
        }
        .system-info-label {
            font-weight: 500;
            color: var(--nexus-text-secondary);
        }
        .system-info-value {
            font-family: var(--nexus-mono);
        }
        
        /* Toast notifications */
        .toast-container {
            position: fixed;
            top: 1rem;
            right: 1rem;
            z-index: 1100;
        }
        
        /* Spinner for loading states */
        .spinner-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }
    </style>
</head>
<body>
  <button class="admin-menu-toggle">
    <i class="fas fa-bars"></i>
  </button>

  <div class="admin-container">
    <!-- Sidebar -->
    <aside class="admin-sidebar">
      <div class="admin-sidebar-header">
        <h1>AI-Collab Admin</h1>
      </div>
      
      <nav class="admin-sidebar-nav">
        <div class="admin-nav-section">
          <div class="admin-nav-section-title">Overview</div>
          <a href="/admin-dashboard.html" class="admin-nav-item">
            <i class="fas fa-tachometer-alt"></i> Dashboard
          </a>
        </div>

        <div class="admin-nav-section">
          <div class="admin-nav-section-title">Management</div>
          <a href="/admin-users.html" class="admin-nav-item">
            <i class="fas fa-users"></i> Users
          </a>
          <a href="/admin-conversations.html" class="admin-nav-item">
            <i class="fas fa-comments"></i> Conversations
          </a>
          <a href="/admin-models.html" class="admin-nav-item">
            <i class="fas fa-robot"></i> AI Models
          </a>
          <a href="/admin-voting.html" class="admin-nav-item">
            <i class="fas fa-poll"></i> Voting
          </a>
        </div>

        <div class="admin-nav-section">
          <div class="admin-nav-section-title">Analytics</div>
          <a href="/admin-analytics.html" class="admin-nav-item">
            <i class="fas fa-chart-line"></i> Revenue & Growth
          </a>
          <a href="/admin-activity.html" class="admin-nav-item">
            <i class="fas fa-user-clock"></i> User Activity
          </a>
          <a href="/admin-feedback.html" class="admin-nav-item">
            <i class="fas fa-comment-dots"></i> AI Feedback
          </a>
        </div>

        <div class="admin-nav-section">
          <div class="admin-nav-section-title">System</div>
          <a href="/admin-settings.html" class="admin-nav-item active">
            <i class="fas fa-cog"></i> Settings
          </a>
          <a href="/hub.html" class="admin-nav-item">
            <i class="fas fa-arrow-left"></i> Back to App
          </a>
          <a href="#" id="admin-logout" class="admin-nav-item">
            <i class="fas fa-sign-out-alt"></i> Logout
          </a>
        </div>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="admin-main">
        <header class="admin-header">
            <div class="admin-header-content">
                <div>
                    <h1 class="admin-page-title">System Settings</h1>
                    <p class="text-muted mb-0">Configure application behavior, manage API access, and view system information</p>
                </div>
            </div>
        </header>
        
        <div class="admin-content">
        <!-- Settings Tabs -->
        <div class="admin-card mb-4">
            <div class="admin-card-header">
                <div>
                    <i class="bi bi-gear-fill me-2"></i> Settings
                </div>
                <div>
                    <button id="save-all-settings" class="btn btn-primary btn-sm">
                        <i class="bi bi-save me-1"></i> Save All Changes
                    </button>
                </div>
            </div>
            <div class="card-body">
                <!-- Tab navigation -->
                <ul class="nav nav-tabs nav-fill mb-4" id="settingsTabList" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="general-tab" data-bs-toggle="tab" data-bs-target="#general" type="button" role="tab" aria-controls="general" aria-selected="true">
                            <i class="bi bi-sliders me-2"></i> General
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="security-tab" data-bs-toggle="tab" data-bs-target="#security" type="button" role="tab" aria-controls="security" aria-selected="false">
                            <i class="bi bi-shield-lock me-2"></i> Security
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="api-tab" data-bs-toggle="tab" data-bs-target="#api" type="button" role="tab" aria-controls="api" aria-selected="false">
                            <i class="bi bi-code-slash me-2"></i> API
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="notifications-tab" data-bs-toggle="tab" data-bs-target="#notifications" type="button" role="tab" aria-controls="notifications" aria-selected="false">
                            <i class="bi bi-bell me-2"></i> Notifications
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="appearance-tab" data-bs-toggle="tab" data-bs-target="#appearance" type="button" role="tab" aria-controls="appearance" aria-selected="false">
                            <i class="bi bi-palette me-2"></i> Appearance
                        </button>
                    </li>
                </ul>

                <!-- Tab contents -->
                <div class="tab-content p-4" id="settingsTabContent">
                    <!-- General Settings -->
                    <div class="tab-pane fade show active" id="general" role="tabpanel" aria-labelledby="general-tab">
                        <div class="setting-group">
                            <h5 class="setting-title">Application Settings</h5>
                            <p class="setting-description">Configure general app behavior and features</p>
                            
                            <div class="mb-3">
                                <label for="app-name" class="form-label">Application Name</label>
                                <input type="text" class="form-control" id="app-name" value="AI Collaboration Hub">
                                <div class="form-text">Displayed in browser title and throughout the application</div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="session-timeout" class="form-label">Session Timeout (minutes)</label>
                                <input type="number" class="form-control" id="session-timeout" min="5" max="1440" value="120">
                                <div class="form-text">Inactive users will be automatically logged out after this period</div>
                            </div>
                            
                            <div class="mb-3 form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="enable-public-signup" checked>
                                <label class="form-check-label" for="enable-public-signup">Allow Public Sign-ups</label>
                                <div class="form-text">When disabled, only administrators can create new accounts</div>
                            </div>
                        </div>
                        
                        <div class="setting-group">
                            <h5 class="setting-title">AI Models</h5>
                            <p class="setting-description">Default model settings for new users</p>
                            
                            <div class="mb-3">
                                <label for="default-model" class="form-label">Default AI Model</label>
                                <select class="form-select" id="default-model">
                                    <option value="claude">Claude (Anthropic)</option>
                                    <option value="gemini">Gemini (Google)</option>
                                    <option value="chatgpt" selected>ChatGPT (OpenAI)</option>
                                    <option value="grok">Grok (xAI)</option>
                                    <option value="llama">Llama (Meta)</option>
                                    <option value="deepseek">DeepSeek</option>
                                </select>
                                <div class="form-text">The default model shown to new users</div>
                            </div>
                            
                            <div class="mb-3 form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="enable-all-models" checked>
                                <label class="form-check-label" for="enable-all-models">Enable All Models</label>
                                <div class="form-text">When disabled, users can only access models explicitly granted to them</div>
                            </div>
                            
                            <div class="mb-3 form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="enable-model-voting" checked>
                                <label class="form-check-label" for="enable-model-voting">Enable Model Voting/Rating</label>
                                <div class="form-text">Allows users to rate AI responses and provide feedback</div>
                            </div>
                        </div>
                        
                        <div class="setting-group">
                            <h5 class="setting-title">Collaboration Features</h5>
                            <p class="setting-description">Configure collaborative AI interaction options</p>
                            
                            <div class="mb-3 form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="enable-collaborative-mode" checked>
                                <label class="form-check-label" for="enable-collaborative-mode">Enable Collaborative Mode</label>
                                <div class="form-text">Allows users to create sessions with multiple AI models</div>
                            </div>
                            
                            <div class="mb-3 form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="enable-debate-mode" checked>
                                <label class="form-check-label" for="enable-debate-mode">Enable Debate Mode</label>
                                <div class="form-text">Allows users to create debate sessions between AI models</div>
                            </div>
                            
                            <div class="mb-3 form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="enable-critique-mode" checked>
                                <label class="form-check-label" for="enable-critique-mode">Enable Critique Mode</label>
                                <div class="form-text">Allows users to have one AI model critique another's responses</div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="max-models-per-session" class="form-label">Maximum Models Per Session</label>
                                <input type="number" class="form-control" id="max-models-per-session" min="1" max="10" value="4">
                                <div class="form-text">Maximum number of AI models that can be used in a single collaborative session</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Security Settings -->
                    <div class="tab-pane fade" id="security" role="tabpanel" aria-labelledby="security-tab">
                        <div class="setting-group">
                            <h5 class="setting-title">Authentication</h5>
                            <p class="setting-description">Configure authentication and account security settings</p>
                            
                            <div class="mb-3 form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="enable-google-auth" checked>
                                <label class="form-check-label" for="enable-google-auth">Google Authentication</label>
                                <div class="form-text">Allow users to sign in with Google accounts</div>
                            </div>
                            
                            <div class="mb-3 form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="enable-email-auth" checked>
                                <label class="form-check-label" for="enable-email-auth">Email Authentication</label>
                                <div class="form-text">Allow users to sign in with email and password</div>
                            </div>
                            
                            <div class="mb-3 form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="require-email-verification" checked>
                                <label class="form-check-label" for="require-email-verification">Require Email Verification</label>
                                <div class="form-text">Users must verify their email address before accessing the application</div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="password-min-length" class="form-label">Minimum Password Length</label>
                                <input type="number" class="form-control" id="password-min-length" min="8" max="128" value="12">
                                <div class="form-text">Minimum number of characters required for passwords</div>
                            </div>
                            
                            <div class="mb-3 form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="require-password-complexity" checked>
                                <label class="form-check-label" for="require-password-complexity">Require Complex Passwords</label>
                                <div class="form-text">Passwords must include uppercase, lowercase, numbers, and special characters</div>
                            </div>
                        </div>
                        
                        <div class="setting-group">
                            <h5 class="setting-title">Session Security</h5>
                            <p class="setting-description">Configure session and login security options</p>
                            
                            <div class="mb-3">
                                <label for="max-login-attempts" class="form-label">Maximum Login Attempts</label>
                                <input type="number" class="form-control" id="max-login-attempts" min="1" max="10" value="5">
                                <div class="form-text">Number of failed login attempts before account lockout</div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="lockout-duration" class="form-label">Account Lockout Duration (minutes)</label>
                                <input type="number" class="form-control" id="lockout-duration" min="5" max="1440" value="30">
                                <div class="form-text">Duration of account lockout after exceeding maximum login attempts</div>
                            </div>
                            
                            <div class="mb-3 form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="enable-ip-blocking" checked>
                                <label class="form-check-label" for="enable-ip-blocking">Enable IP Blocking</label>
                                <div class="form-text">Block IP addresses with suspicious activity patterns</div>
                            </div>
                        </div>
                        
                        <div class="setting-group">
                            <h5 class="setting-title">Admin Accounts</h5>
                            <p class="setting-description">Manage administrator access</p>
                            
                            <div class="mb-3">
                                <label class="form-label">Create Admin Account</label>
                                <div class="input-group mb-3">
                                    <input type="email" class="form-control" id="admin-email" placeholder="Email address">
                                    <button class="btn btn-primary" type="button" id="create-admin-btn">Create Admin</button>
                                </div>
                                <div class="form-text">Create a new administrator account with full system access</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- API Settings -->
                    <div class="tab-pane fade" id="api" role="tabpanel" aria-labelledby="api-tab">
                        <div class="setting-group">
                            <h5 class="setting-title">API Access</h5>
                            <p class="setting-description">Manage API features and access control</p>
                            
                            <div class="mb-3 form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="enable-api" checked>
                                <label class="form-check-label" for="enable-api">Enable API Access</label>
                                <div class="form-text">Allow programmatic access to the application via the REST API</div>
                            </div>
                            
                            <div class="mb-3 form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="require-api-key" checked>
                                <label class="form-check-label" for="require-api-key">Require API Key Authentication</label>
                                <div class="form-text">All API requests must include a valid API key</div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="rate-limit" class="form-label">API Rate Limit (requests per minute)</label>
                                <input type="number" class="form-control" id="rate-limit" min="10" max="10000" value="120">
                                <div class="form-text">Maximum number of API requests allowed per minute per user</div>
                            </div>
                        </div>
                        
                        <div class="setting-group">
                            <h5 class="setting-title">API Keys</h5>
                            <p class="setting-description">Generate and manage API keys for external integrations</p>
                            
                            <div class="mb-3">
                                <label class="form-label">Generate New API Key</label>
                                <div class="input-group mb-3">
                                    <input type="text" class="form-control" id="api-key-name" placeholder="Key Name (e.g., Production, Testing)">
                                    <button class="btn btn-primary" type="button" id="generate-api-key">Generate Key</button>
                                </div>
                            </div>
                            
                            <div class="mb-3 d-none" id="api-key-display">
                                <label class="form-label">Your New API Key</label>
                                <div class="token-display mb-2" id="api-key-value">api_key_123456789abcdef</div>
                                <div class="form-text text-warning">Please copy this key now. It will not be shown again.</div>
                            </div>
                            
                            <!-- Existing API Keys Table -->
                            <div class="table-responsive">
                                <table class="table table-sm">
                                    <thead>
                                        <tr>
                                            <th>Name</th>
                                            <th>Created</th>
                                            <th>Last Used</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>Production</td>
                                            <td>May 10, 2025</td>
                                            <td>May 14, 2025</td>
                                            <td><span class="badge bg-success">Active</span></td>
                                            <td>
                                                <button class="btn btn-sm btn-outline-danger" title="Revoke Key">
                                                    <i class="bi bi-x-circle"></i>
                                                </button>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>Testing</td>
                                            <td>Apr 22, 2025</td>
                                            <td>May 13, 2025</td>
                                            <td><span class="badge bg-success">Active</span></td>
                                            <td>
                                                <button class="btn btn-sm btn-outline-danger" title="Revoke Key">
                                                    <i class="bi bi-x-circle"></i>
                                                </button>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>Development</td>
                                            <td>Mar 15, 2025</td>
                                            <td>Apr 30, 2025</td>
                                            <td><span class="badge bg-danger">Revoked</span></td>
                                            <td>
                                                <button class="btn btn-sm btn-outline-secondary" disabled title="Revoke Key">
                                                    <i class="bi bi-x-circle"></i>
                                                </button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <div class="setting-group">
                            <h5 class="setting-title">API Documentation</h5>
                            <p class="setting-description">Available API endpoints and usage examples</p>
                            
                            <div class="mb-3">
                                <div class="table-responsive">
                                    <table class="table">
                                        <thead>
                                            <tr>
                                                <th>Endpoint</th>
                                                <th>Method</th>
                                                <th>Description</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td><code>/api/models</code></td>
                                                <td><span class="api-method get">GET</span></td>
                                                <td>List all available AI models</td>
                                            </tr>
                                            <tr>
                                                <td><code>/api/conversations</code></td>
                                                <td><span class="api-method get">GET</span></td>
                                                <td>List user conversations</td>
                                            </tr>
                                            <tr>
                                                <td><code>/api/conversations</code></td>
                                                <td><span class="api-method post">POST</span></td>
                                                <td>Create a new conversation</td>
                                            </tr>
                                            <tr>
                                                <td><code>/api/conversations/{id}</code></td>
                                                <td><span class="api-method get">GET</span></td>
                                                <td>Get a specific conversation</td>
                                            </tr>
                                            <tr>
                                                <td><code>/api/conversations/{id}/messages</code></td>
                                                <td><span class="api-method post">POST</span></td>
                                                <td>Send a message to a conversation</td>
                                            </tr>
                                            <tr>
                                                <td><code>/api/users</code></td>
                                                <td><span class="api-method get">GET</span></td>
                                                <td>List all users (admin only)</td>
                                            </tr>
                                            <tr>
                                                <td><code>/api/users/{id}</code></td>
                                                <td><span class="api-method put">PUT</span></td>
                                                <td>Update a user (admin only)</td>
                                            </tr>
                                            <tr>
                                                <td><code>/api/users/{id}</code></td>
                                                <td><span class="api-method delete">DELETE</span></td>
                                                <td>Delete a user (admin only)</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="form-text">
                                    <a href="#" class="text-decoration-none">View Full API Documentation <i class="bi bi-box-arrow-up-right ms-1"></i></a>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Notification Settings -->
                    <div class="tab-pane fade" id="notifications" role="tabpanel" aria-labelledby="notifications-tab">
                        <div class="setting-group">
                            <h5 class="setting-title">Email Notifications</h5>
                            <p class="setting-description">Configure system email notifications</p>
                            
                            <div class="mb-3">
                                <label for="email-sender" class="form-label">Sender Email Address</label>
                                <input type="email" class="form-control" id="email-sender" value="no-reply@aicollab.example.com">
                                <div class="form-text">Address used as the sender for all system emails</div>
                            </div>
                            
                            <div class="mb-3 form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="notify-new-user" checked>
                                <label class="form-check-label" for="notify-new-user">New User Registration</label>
                                <div class="form-text">Send notification to admins when a new user registers</div>
                            </div>
                            
                            <div class="mb-3 form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="notify-failed-login" checked>
                                <label class="form-check-label" for="notify-failed-login">Failed Login Attempts</label>
                                <div class="form-text">Send notification when multiple failed login attempts are detected</div>
                            </div>
                            
                            <div class="mb-3 form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="notify-subscription-change" checked>
                                <label class="form-check-label" for="notify-subscription-change">Subscription Changes</label>
                                <div class="form-text">Send notification when a user's subscription tier changes</div>
                            </div>
                        </div>
                        
                        <div class="setting-group">
                            <h5 class="setting-title">Admin Alerts</h5>
                            <p class="setting-description">Configure system monitoring and alerts</p>
                            
                            <div class="mb-3 form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="alert-system-error" checked>
                                <label class="form-check-label" for="alert-system-error">System Errors</label>
                                <div class="form-text">Send notification when critical system errors occur</div>
                            </div>
                            
                            <div class="mb-3 form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="alert-api-usage" checked>
                                <label class="form-check-label" for="alert-api-usage">High API Usage</label>
                                <div class="form-text">Send notification when API usage exceeds normal thresholds</div>
                            </div>
                            
                            <div class="mb-3 form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="alert-database-size" checked>
                                <label class="form-check-label" for="alert-database-size">Database Size</label>
                                <div class="form-text">Send notification when database size approaches capacity limits</div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="alert-email" class="form-label">Alert Recipient Email</label>
                                <input type="email" class="form-control" id="alert-email" value="admin@aicollab.example.com">
                                <div class="form-text">Email address to receive system alerts</div>
                            </div>
                        </div>
                        
                        <div class="setting-group">
                            <h5 class="setting-title">User Notifications</h5>
                            <p class="setting-description">Configure user notification defaults</p>
                            
                            <div class="mb-3 form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="notify-welcome-email" checked>
                                <label class="form-check-label" for="notify-welcome-email">Welcome Email</label>
                                <div class="form-text">Send welcome email to new users upon registration</div>
                            </div>
                            
                            <div class="mb-3 form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="notify-account-activity">
                                <label class="form-check-label" for="notify-account-activity">Account Activity</label>
                                <div class="form-text">Send notification for important account activity (login from new device, etc.)</div>
                            </div>
                            
                            <div class="mb-3 form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="notify-product-updates" checked>
                                <label class="form-check-label" for="notify-product-updates">Product Updates</label>
                                <div class="form-text">Send notification about new features and product updates</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Appearance Settings -->
                    <div class="tab-pane fade" id="appearance" role="tabpanel" aria-labelledby="appearance-tab">
                        <div class="setting-group">
                            <h5 class="setting-title">Brand Customization</h5>
                            <p class="setting-description">Customize the application appearance and branding</p>
                            
                            <div class="mb-3">
                                <label for="app-logo" class="form-label">Application Logo</label>
                                <input type="file" class="form-control" id="app-logo">
                                <div class="form-text">Recommended size: 200x60px, PNG or SVG format</div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="app-favicon" class="form-label">Favicon</label>
                                <input type="file" class="form-control" id="app-favicon">
                                <div class="form-text">Recommended size: 32x32px, ICO or PNG format</div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="primary-color" class="form-label">Primary Color</label>
                                <input type="color" class="form-control form-control-color" id="primary-color" value="#3c7eff">
                                <div class="form-text">Main brand color used throughout the application</div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="secondary-color" class="form-label">Secondary Color</label>
                                <input type="color" class="form-control form-control-color" id="secondary-color" value="#6c757d">
                                <div class="form-text">Secondary color used for accents and highlights</div>
                            </div>
                        </div>
                        
                        <div class="setting-group">
                            <h5 class="setting-title">Theme Settings</h5>
                            <p class="setting-description">Configure application theme options</p>
                            
                            <div class="mb-3">
                                <label for="default-theme" class="form-label">Default Theme</label>
                                <select class="form-select" id="default-theme">
                                    <option value="theme-dark" selected>Dark</option>
                                    <option value="theme-light">Light</option>
                                    <option value="system">System Default</option>
                                </select>
                                <div class="form-text">Default theme for new users and guests</div>
                            </div>
                            
                            <div class="mb-3 form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="allow-theme-toggle" checked>
                                <label class="form-check-label" for="allow-theme-toggle">Allow Theme Toggle</label>
                                <div class="form-text">Allow users to switch between light and dark themes</div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="font-size" class="form-label">Base Font Size</label>
                                <select class="form-select" id="font-size">
                                    <option value="small">Small</option>
                                    <option value="medium" selected>Medium</option>
                                    <option value="large">Large</option>
                                </select>
                                <div class="form-text">Base font size for UI elements and text</div>
                            </div>
                        </div>
                        
                        <div class="setting-group">
                            <h5 class="setting-title">Custom CSS</h5>
                            <p class="setting-description">Add custom CSS for advanced styling</p>
                            
                            <div class="mb-3">
                                <textarea class="form-control json-editor" id="custom-css" rows="6" placeholder="/* Add your custom CSS here */"></textarea>
                                <div class="form-text">Custom CSS will be applied throughout the application</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- System Info & Logs -->
        <div class="row">
            <div class="col-md-6">
                <div class="admin-card">
                    <div class="admin-card-header">
                        <div>
                            <i class="bi bi-info-circle-fill me-2"></i> System Information
                        </div>
                        <div>
                            <button class="btn btn-sm btn-outline-secondary" id="refresh-system-info">
                                <i class="bi bi-arrow-clockwise me-1"></i> Refresh
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="system-info-item">
                            <div class="system-info-label">Version</div>
                            <div class="system-info-value" id="system-version">-</div>
                        </div>
                        <div class="system-info-item">
                            <div class="system-info-label">Node.js Version</div>
                            <div class="system-info-value" id="nodejs-version">-</div>
                        </div>
                        <div class="system-info-item">
                            <div class="system-info-label">MongoDB Version</div>
                            <div class="system-info-value" id="mongodb-version">-</div>
                        </div>
                        <div class="system-info-item">
                            <div class="system-info-label">System Uptime</div>
                            <div class="system-info-value" id="system-uptime">-</div>
                        </div>
                        <div class="system-info-item">
                            <div class="system-info-label">Database Size</div>
                            <div class="system-info-value" id="database-size">-</div>
                        </div>
                        <div class="system-info-item">
                            <div class="system-info-label">Memory Usage</div>
                            <div class="system-info-value" id="memory-usage">-</div>
                        </div>
                        <div class="system-info-item">
                            <div class="system-info-label">CPU Usage</div>
                            <div class="system-info-value" id="cpu-usage">-</div>
                        </div>
                        <div class="system-info-item">
                            <div class="system-info-label">Total Users</div>
                            <div class="system-info-value" id="total-users">-</div>
                        </div>
                        <div class="system-info-item">
                            <div class="system-info-label">Total Conversations</div>
                            <div class="system-info-value" id="total-conversations">-</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="admin-card">
                    <div class="admin-card-header">
                        <div>
                            <i class="bi bi-journal-text me-2"></i> System Logs
                        </div>
                        <div>
                            <select class="form-select form-select-sm" id="log-level">
                                <option value="all">All Levels</option>
                                <option value="error">Errors Only</option>
                                <option value="warn">Warnings & Errors</option>
                                <option value="info">Info & Above</option>
                            </select>
                        </div>
                    </div>
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-sm table-hover mb-0 log-table">
                                <thead>
                                    <tr>
                                        <th>Timestamp</th>
                                        <th>Level</th>
                                        <th>Source</th>
                                        <th>Message</th>
                                    </tr>
                                </thead>
                                <tbody id="log-table-body">
                                    <tr>
                                        <td colspan="4" class="text-center text-muted py-3">Loading logs...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="card-footer d-flex justify-content-between align-items-center">
                        <div>
                            <button class="btn btn-sm btn-outline-secondary me-2" id="clear-logs">
                                <i class="bi bi-trash me-1"></i> Clear Logs
                            </button>
                            <button class="btn btn-sm btn-outline-secondary" id="download-logs">
                                <i class="bi bi-download me-1"></i> Download Logs
                            </button>
                        </div>
                        <div>
                            <button class="btn btn-sm btn-primary" id="view-all-logs">
                                View All Logs <i class="bi bi-arrow-right ms-1"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        </div><!-- End admin-content -->
    </main>
  </div><!-- End admin-container -->

    <!-- Toast container for notifications -->
    <div class="toast-container position-fixed top-0 end-0 p-3">
        <div id="settings-toast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <i class="bi bi-check-circle-fill text-success me-2"></i>
                <strong class="me-auto">Settings</strong>
                <small>Just now</small>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body">
                Settings saved successfully.
            </div>
        </div>
    </div>

    <!-- Loading Spinner -->
    <div class="spinner-overlay d-none" id="loading-spinner">
        <div class="spinner-border text-light" style="width: 3rem; height: 3rem;" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Toggle sidebar on mobile
            document.querySelector('.admin-menu-toggle')?.addEventListener('click', function() {
                document.querySelector('.admin-sidebar').classList.toggle('collapsed');
            });

            // Logout functionality
            document.getElementById('admin-logout').addEventListener('click', function(e) {
                e.preventDefault();
                localStorage.removeItem('adminToken');
                window.location.href = '/admin.html';
            });
            
            // Initialize tooltips
            const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
            tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl);
            });
            
            // Settings toast
            const settingsToast = new bootstrap.Toast(document.getElementById('settings-toast'));
            
            // Save all settings
            document.getElementById('save-all-settings').addEventListener('click', function() {
                saveSettings();
            });
            
            // API key generation
            document.getElementById('generate-api-key').addEventListener('click', function() {
                const keyName = document.getElementById('api-key-name').value.trim();
                if (!keyName) {
                    alert('Please enter a name for the API key.');
                    return;
                }
                
                // Request API key from server
                showSpinner();
                fetch('/api/admin/settings/generate-api-key', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name: keyName })
                })
                .then(response => response.json())
                .then(data => {
                    hideSpinner();
                    if (data.apiKey) {
                        const apiKey = data.apiKey;
                        
                        // Display the key
                        document.getElementById('api-key-value').textContent = apiKey;
                        document.getElementById('api-key-display').classList.remove('d-none');
                        
                        // Clear the input
                        document.getElementById('api-key-name').value = '';
                    }
                })
                .catch(error => {
                    hideSpinner();
                    console.error('Error generating API key:', error);
                });
            });
            
            // Create admin account
            document.getElementById('create-admin-btn').addEventListener('click', function() {
                const adminEmail = document.getElementById('admin-email').value.trim();
                if (!adminEmail) {
                    alert('Please enter an email address for the admin account.');
                    return;
                }
                
                showSpinner();
                
                // In production, this would be a server API call
                setTimeout(() => {
                    // Simulate successful admin creation
                    hideSpinner();
                    alert(`Admin creation link sent to ${adminEmail}`);
                    document.getElementById('admin-email').value = '';
                }, 500);
            });
            
            // Refresh system info
            document.getElementById('refresh-system-info').addEventListener('click', function() {
                showSpinner();
                
                // In production, this would be a server API call
                setTimeout(() => {
                    // Simulate updated system info
                    // Fetch system info from server
                    fetch('/api/admin/system/info')
                        .then(response => response.json())
                        .then(data => {
                            hideSpinner();
                            if (data.success) {
                                updateSystemInfo(data);
                            }
                        })
                        .catch(error => {
                            hideSpinner();
                            console.error('Error fetching system info:', error);
                        });
                }, 500);
            });
            
            // Log filtering
            document.getElementById('log-level').addEventListener('change', function() {
                loadSystemLogs(this.value);
            });
            
            // Clear logs
            document.getElementById('clear-logs').addEventListener('click', function() {
                if (confirm('Are you sure you want to clear all logs? This action cannot be undone.')) {
                    showSpinner();
                    
                    // In production, this would be a server API call
                    setTimeout(() => {
                        // Simulate cleared logs
                        hideSpinner();
                        alert('Logs have been cleared.');
                    }, 500);
                }
            });
            
            // Download logs
            document.getElementById('download-logs').addEventListener('click', function() {
                showSpinner();
                
                // In production, this would generate a file from the server
                setTimeout(() => {
                    // Download logs from server
                    fetch('/api/admin/logs/download')
                        .then(response => response.blob())
                        .then(blob => {
                            hideSpinner();
                            const url = URL.createObjectURL(blob);
                            const link = document.createElement('a');
                            link.href = url;
                            link.download = `system_logs_${new Date().toISOString().slice(0, 10)}.log`;
                            link.click();
                            URL.revokeObjectURL(url);
                        })
                        .catch(error => {
                            hideSpinner();
                            console.error('Error downloading logs:', error);
                        });
                }, 500);
            });
            
            // Date picker for custom theme
            document.getElementById('default-theme').addEventListener('change', function() {
                // Apply the selected theme to the document for preview
                document.documentElement.className = this.value;
            });
            
            // Save settings
            function saveSettings() {
                showSpinner();
                
                // In production, this would be a server API call to save all settings
                setTimeout(() => {
                    // Simulate successful save
                    hideSpinner();
                    
                    // Show success toast
                    settingsToast.show();
                }, 1000);
            }
            
            // Show loading spinner
            function showSpinner() {
                document.getElementById('loading-spinner').classList.remove('d-none');
            }
            
            // Hide loading spinner
            function hideSpinner() {
                document.getElementById('loading-spinner').classList.add('d-none');
            }
            
            // Update system info
            function updateSystemInfo(data) {
                if (data.system) {
                    document.getElementById('system-version').textContent = data.system.version || 'Unknown';
                    document.getElementById('nodejs-version').textContent = data.system.nodeVersion || 'Unknown';
                    
                    // Format uptime
                    const uptimeSeconds = data.system.uptime || 0;
                    const days = Math.floor(uptimeSeconds / 86400);
                    const hours = Math.floor((uptimeSeconds % 86400) / 3600);
                    const minutes = Math.floor((uptimeSeconds % 3600) / 60);
                    document.getElementById('system-uptime').textContent = `${days}d ${hours}h ${minutes}m`;
                    
                    // Memory usage percentage
                    const memUsage = data.system.totalMemory && data.system.freeMemory ? 
                        Math.round((1 - data.system.freeMemory / data.system.totalMemory) * 100) : 0;
                    document.getElementById('memory-usage').textContent = `${memUsage}%`;
                    
                    // CPU usage from load average
                    const loadAvg = data.system.loadAverage ? data.system.loadAverage[0] : 0;
                    const cpuCount = data.system.cpus ? data.system.cpus.length : 1;
                    const cpuUsage = Math.min(100, Math.round((loadAvg / cpuCount) * 100));
                    document.getElementById('cpu-usage').textContent = `${cpuUsage}%`;
                }
                
                if (data.database) {
                    // MongoDB version not available from stats, show as N/A
                    document.getElementById('mongodb-version').textContent = 'N/A';
                    
                    // Format database size
                    const dbSize = data.database.dataSize || 0;
                    const dbSizeFormatted = dbSize > 1024 * 1024 * 1024 ? 
                        `${(dbSize / (1024 * 1024 * 1024)).toFixed(2)} GB` :
                        dbSize > 1024 * 1024 ?
                        `${(dbSize / (1024 * 1024)).toFixed(2)} MB` :
                        `${(dbSize / 1024).toFixed(2)} KB`;
                    document.getElementById('database-size').textContent = dbSizeFormatted;
                }
                
                if (data.counts) {
                    document.getElementById('total-users').textContent = data.counts.users || 0;
                    document.getElementById('total-conversations').textContent = data.counts.conversations || 0;
                }
            }
            
            // Load system logs
            function loadSystemLogs(level = 'all') {
                fetch(`/api/admin/system/logs?level=${level}`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.success && data.logs) {
                            const tbody = document.getElementById('log-table-body');
                            tbody.innerHTML = '';
                            
                            if (data.logs.length === 0) {
                                tbody.innerHTML = '<tr><td colspan="4" class="text-center text-muted py-3">No logs found</td></tr>';
                                return;
                            }
                            
                            data.logs.forEach(log => {
                                const row = document.createElement('tr');
                                const timestamp = new Date(log.timestamp).toLocaleString();
                                const levelClass = `log-${log.level.toLowerCase()}`;
                                
                                row.innerHTML = `
                                    <td>${timestamp}</td>
                                    <td><span class="log-level ${levelClass}">${log.level}</span></td>
                                    <td>${log.source}</td>
                                    <td>${log.message}</td>
                                `;
                                tbody.appendChild(row);
                            });
                        }
                    })
                    .catch(error => {
                        console.error('Error loading logs:', error);
                        const tbody = document.getElementById('log-table-body');
                        tbody.innerHTML = '<tr><td colspan="4" class="text-center text-danger py-3">Error loading logs</td></tr>';
                    });
            }
            
            // Load system info on page load
            fetch('/api/admin/system/info')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        updateSystemInfo(data);
                    }
                })
                .catch(error => {
                    console.error('Error loading system info:', error);
                });
                
            // Load system logs on page load
            loadSystemLogs();
        });
    </script>
</body>
</html>